<a id="_____"></a><a id="_Toc515962800"></a>《推荐系统三十六式》

[1\.	开篇词	1](#_103)

[1\.1\.	用知识去对抗技术不平等	1](#_104)

[1\.1\.1\.	但凡AI类的落地，都需要具备这几个基本元素才行：数据、算法、场景、计算力	1](#_119)

[1\.1\.2\.	有一个趋势确信无疑：世界在向网状发展，万事万物倾向于相互连接构成复杂网络	1](#_120)

[2\.	概念篇	1](#_101)

[2\.1\.	1\.你真的需要个性化推荐系统吗？	1](#_102)

[2\.1\.1\.	什么是推荐系统？按照维基百科的定义：它是一种信息过滤系统，手段是预测用户（User）对物品（Item）的评分与偏好	1](#_121)

[2\.1\.2\.	推荐系统能做什么？推荐系统可以把那些最终会在用户（User）和物品（Item）之间产生的连接提前找出来	1](#_122)

[2\.1\.3\.	推荐系统需要什么？需要已经存在的连接，从已有的连接去预测未来的连接	1](#_123)

[2\.1\.4\.	一个简单的指标，用于判断是不是需要推荐系统：connection的变化量/（user的变量量\*item的变化量）	1](#_124)

[2\.1\.5\.	搭建一个推荐系统的前期投入不小，需要：组建团队、购置计算资源、积累数据、花费时间优化	1](#_125)

[2\.2\.	2\.个性化推荐系统有哪些绕不开的经典问题？	1](#_105)

[2\.2\.1\.	推荐系统的预测问题模式，从达成的连接目标角度区分有两大类：评分预测、行为预测	1](#_126)

[2\.2\.2\.	评分预测相关算法模型研究的兴盛，最大的助攻是Netflix举办的推荐算法大赛	2](#_127)

[2\.2\.3\.	推荐系统预测行为方式有很多，常见的有两种：直接预测行为本身产生的概率，和预测物品的相对排序	2](#_128)

[2\.2\.4\.	把每一个推荐给用户的物品按照“会否点击”二分类，构建分类模型，预估其中一种分类的概率，就是CTR预估	2](#_129)

[2\.2\.5\.	各大厂高度重视隐式反馈，归纳起来有以下几点原因：1、数据比显式反馈更加稠密；2、隐式反馈更代表用户的真实想法；3、隐式反馈常常和模型的目标函数关联密切	2](#_130)

[2\.2\.6\.	推荐系统的几个顽疾：1、冷启动问题；2、探索与利用问题；3、安全问题	2](#_131)

[2\.3\.	3\.这些你必须应该具备的思维模式	2](#_106)

[2\.3\.1\.	四个关键的元素：1、UI和UE；2、数据；3、领域知识；4、算法	2](#_132)

[2\.3\.2\.	一种对算法的常见误会：短期高估，长期低估	2](#_133)

[2\.3\.3\.	两种思维模式：目标思维和不确定性思维	2](#_134)

[2\.3\.4\.	目标思维背后是“量化一切”的价值取向	2](#_135)

[2\.3\.5\.	不确定性思维就是：不用因果逻辑严丝合缝地提前推演，而是用概率的眼光去看结果	2](#_136)

[3\.	原理篇：内容推荐	2](#_107)

[3\.1\.	4\.画鬼容易画人难：用户画像的“能”和“不能”	2](#_108)

[3\.1\.1\.	用户画像不是推荐系统的目的，而是在构建推荐系统的过程中产生的一个关键环节的副产品	2](#_137)

[3\.1\.2\.	通常大型推荐系统一般都分为召回和排序两个阶段	3](#_138)

[3\.1\.3\.	建立用户画像的关键因素：第一个是维度，第二个是量化	3](#_139)

[3\.1\.4\.	按照对用户向量化的手段来分，用户画像构建方法分成三类：第一类是查户口；第二类是堆数据；第三类是黑盒子	3](#_140)

[3\.1\.5\.	查户口就是直接使用原始数据作为用户画像的内容；堆数据就是堆积历史数据，做统计工作；黑盒子就是用机器学习方法，学习出人类无法直观理解的稠密向量	3](#_141)

[3\.2\.	5\.从文本到用户画像有多远	3](#_109)

[3\.2\.1\.	文本数据是互联网产品中最常见的信息表达形式，数量多、处理快、存储小	3](#_142)

[3\.2\.2\.	要用物品和用户的文本信息构建出一个基础版本的用户画像，大致需要做这些事：1、把所有非结构化的文本结构化，去粗取精，保留关键信息；2、根据用户行为数据把物品的结构化结果传递给用户，与用户自己的结构信息合并	3](#_143)

[3\.2\.3\.	利用成熟的NLP算法分析得到的信息有下面几种：1、关键词提取；2、实体识别；3、内容分类；4、文本；5、主题模型；6、嵌入	3](#_144)

[3\.2\.4\.	标签选择，一种简单粗暴的办法是直接把用户产生过行为的物品标签累积在一起	3](#_145)

[3\.2\.5\.	另一种思路是把用户对物品的行为，消费或者没有消费看成一个分类问题	3](#_146)

[3\.2\.6\.	特征选择问题最常用的是两个方法：卡方检验（CHI）和信息增益（IG）	3](#_147)

[3\.2\.7\.	CHI就是卡方检验，本身是一种特征选择方法	3](#_148)

[3\.2\.8\.	IG即Information Gain，信息增益，也是一种有监督的关键词选择方法，也需要有标注信息	4](#_149)

[3\.2\.9\.	信息增益应用最广就是数据挖掘中的决策树分类算法，经典的决策树分类算法挑选分裂节点时就是计算各个属性的信息增益，始终挑选信息增益最大的节点作为分裂节点	4](#_150)

[3\.2\.10\.	卡方检验和信息增益不同之处在于：前者是针对每一个行为单独筛选一套标签出来，后者是全局统一筛选	4](#_151)

[3\.3\.	6\.超越标签的内容推荐系统	4](#_110)

[3\.3\.1\.	基于内容的推荐系统，标签只是很小一部分	4](#_152)

[3\.3\.2\.	要把基于内容的推荐做好，需要做好“抓、洗、挖、算”四门功课	4](#_153)

[3\.3\.3\.	抓：抓取数据补充内容源，洗：清洗冗余的内容、垃圾内容、政治色情等敏感内容，挖：对内容做深入的挖掘，算：匹配用户的兴趣和物品的属性，计算出更合理的相关性	4](#_154)

[3\.3\.4\.	典型基于内容推荐的框架图：内容这一端，内容源经过内容分析，得到结构化的内容库和内容模型，也就是物品画像。用户这一端，用户看过推荐列表后，会产生用户行为数据，结合物品画像，经过用户分析得到用户画像	4](#_155)

[3\.3\.5\.	内容分析的产出有两个：1、结构化内容库，2、内容分析模型	4](#_156)

[3\.3\.6\.	结构化的内容库，最重要的用途是结合用户反馈行为去学习用户画像，容易被忽略的是第二个用途，在内容分析过程中得到的模型	4](#_157)

[3\.3\.7\.	内容推荐的算法，一种最典型的场景：提高某种行为的转化率，如点击、收藏、转发等	4](#_158)

[3\.3\.8\.	基于内容的推荐一般是推荐系统的起步阶段，而且会持续存在，它的重要性不可取代	5](#_159)

[4\.	原理篇：近邻推荐	5](#_111)

[4\.1\.	7\.人以群分，你是什么人就看到什么世界	5](#_112)

[4\.1\.1\.	协同过滤是一个比较大的算法范畴，通常划分为两类：1、基于记忆的协同过滤；2、基于模型的协同过滤；	5](#_192)

[4\.1\.2\.	背后的思想：先根据历史消费行为帮你找到一群和你口味很相似的用户；然后根据这些和你很相似的用户再消费了什么新的、你没有见过的物品，都推荐给你	5](#_193)

[4\.1\.3\.	核心是用户物品的关系矩阵	5](#_194)

[4\.1\.4\.	典型的稀疏矩阵存储格式：CSR、COO	5](#_195)

[4\.1\.5\.	通常降低相似度计算复杂度的办法有两种：1、对向量采样计算；2、向量化计算	5](#_196)

[4\.1\.6\.	一般来说，中小型公司如果没有特别必要的话，不要用分布式计算；拆分Map Reduce任务也不一定非要用Hadoop或者Spark实现	5](#_197)

[4\.1\.7\.	改进主要集中在用户对物品的喜欢程度上：1、惩罚对热门物品的喜欢程度；2、增加喜欢程度的时间衰减	5](#_198)

[4\.1\.8\.	基于用户的协同过滤有两个产出：1、相似用户列表；2、基于用户的推荐结果	5](#_199)

[4\.2\.	8\.解密“看了又看”和“买了又买”	5](#_113)

[4\.2\.1\.	基于物品的协同过滤算法诞生与1998年，是由亚马逊首先提出的	5](#_200)

[4\.2\.2\.	基本步骤：1、构建用户物品的关系矩阵；2、两两计算行向量之间的相似度；3、根据推荐场景不同，产生推荐结果	6](#_201)

[4\.2\.3\.	计算物品的相似度，一般选择余弦相似度	6](#_202)

[4\.2\.4\.	通常的改进方向有两种：1、物品中心化；2、用户中心化	6](#_203)

[4\.2\.5\.	计算推荐结果：第一种属于TopK推荐，类似“猜你喜欢”；第二种属于相关推荐	6](#_204)

[4\.2\.6\.	Slope One算法计算的不是物品之间的相似度，而是计算的物品之间的距离，相似度的反面	6](#_205)

[4\.3\.	9\.协同过滤中的相似度计算方法有哪些	6](#_114)

[4\.3\.1\.	推荐算法分为两个门派，一个是机器学习派，另一个是相似度门派	6](#_206)

[4\.3\.2\.	近邻推荐的核心就是相似度计算方法的选择	6](#_207)

[4\.3\.3\.	在近邻推荐中，最常用的相似度是余弦相似度，除此之外还有欧式距离、皮尔逊相关度、自适应的余弦相似度、局部敏感哈希等	6](#_208)

[4\.3\.4\.	欧式距离，是一个欧式空间下度量距离的方法，不适合布尔向量之间	6](#_209)

[4\.3\.5\.	余弦相似度度量的是两个向量之间的夹角	6](#_210)

[4\.3\.6\.	皮尔逊相关度，先对向量做了中心化，再计算余弦相似度，不适合用作计算布尔值向量之间相关度	6](#_211)

[4\.3\.7\.	杰卡德相似度，是两个集合的交集元素个数在并集中所占的比例，是为布尔值向量私人定做的	6](#_212)

[4\.3\.8\.	余弦相似度适用于评分数据，杰卡德相似度适合用于隐式反馈数据	6](#_213)

[5\.	原理篇：矩阵分解	7](#_115)

[5\.1\.	10\.那些在Netflix Prize中大放异彩的推荐算法	7](#_116)

[5\.1\.1\.	几点近邻模型的问题：1、物品之间存在相关性，信息量并不随着向量维度增加二线性增加；2、矩阵元素稀疏，计算结果不稳定，增减一个向量维度，导致近邻结果差异很大的情况存在	7](#_214)

[5\.1\.2\.	矩阵分解，直观上来说简单，就是把原来的矩阵，近似分解成两个小矩阵的乘积，在实际推荐计算时不再使用大矩阵，而是使用分解得到的两个小矩阵	7](#_215)

[5\.1\.3\.	SVD和矩阵分解不能划等号，因为除了SVD还有一些别的矩阵分解方法	7](#_216)

[5\.1\.4\.	按照机器学习框架，一般就是考虑两个核心要素：1、损失函数；2、优化算法	7](#_217)

[5\.1\.5\.	整个SVD的学习过程就是：1、准备好用户物品的评分矩阵，每一条评分数据看做一条训练样本；2、给分解后的U矩阵和V矩阵随机初始化元素值；3、用U和V计算预测后的分数；4、计算预测的分数和实际的分数误差；5、按照梯度下降的方向跟新U和V中的元素值；6、重复步骤3到5，知道达到停止条件	7](#_218)

[5\.1\.6\.	在SVD中考虑时间因素，有几种做法：1、对评分按照时间加权，让久远的评分更趋紧平均值；2、对评分时间划分区间，不同呃时间区间分别学习出隐因子向量，使用时按照区间使用对应的隐因子向量来计算；3、对特殊的期间，如节日、周末等训练对应的隐因子向量	7](#_219)

[5\.1\.7\.	SVD及其一些典型的改进方案分别是：1、考虑偏置信息；2、考虑隐式反馈和用户属性；3、考虑时间因素	7](#_220)

[5\.2\.	11\.Facebook是怎么为十亿人互相推荐好友的	7](#_117)

[5\.2\.1\.	矩阵分解要将用户物品评分矩阵分解成两个小矩阵，一个矩阵是代表用户偏好的用户隐因子向量组成，另一个矩阵是代表物品语义主题的隐因子向量组成	8](#_221)

[5\.2\.2\.	所以矩阵分解，所做的事就是矩阵填充	8](#_222)

[5\.2\.3\.	几乎所有的及其学习训练中：偏差大的模型欠拟合，方差大的模型过拟合	8](#_223)

[5\.2\.4\.	优化方法常用的选择有两个，一个是随机梯度下降（SGD），另一个是交替最小二乘（ALS）	8](#_224)

[5\.2\.5\.	在实际应用中，交替最小二乘更常用一些	8](#_225)

[5\.2\.6\.	Facebook提出了两个方法得到真正的推荐结果：1、利用一些专门设计的数据结构存储所有物品的隐因子向量，从而实现通过一个用户向量可以返回最相似的K个物品；2、拿着物品的隐因子向量先做聚类，海量的物品会减少为少量的聚类。然后再逐一计算用户和每个聚类中心的推荐分数，给用户推荐物品就变成了给用户推荐物品聚类	8](#_226)

[5\.3\.	12\.如果关注排序效果，那么这个模型可以帮到你	8](#_118)

[5\.3\.1\.	有一个词叫做均方根误差，用于评价模型预测精准程度的	8](#_227)

[6\.	原理篇：模型融合	8](#_160)

[6\.1\.	13\.经典模型融合方法：线性模型和输模型的组合拳	8](#_169)

[6\.1\.1\.	推荐系统在技术实现上一般划分为三个阶段：挖掘、召回、排序。	8](#_327)

[6\.1\.2\.	在召回阶段，其实就是各种简单的、复杂的推荐算法，比如说基于内容的推荐，会产生一些推荐结果，比如基于物品的协同过滤会产生一些结果，矩阵分解会产生一些结果，等等。	8](#_328)

[6\.1\.3\.	模型融合的作用除了统一地方军阀，还有集中提升效果的作用。在机器学习中，有专门为融合而生的集成学习思想。	9](#_329)

[6\.1\.4\.	一个典型的模型融合方案是：逻辑回归和梯度提升决策树组合	9](#_330)

[6\.1\.5\.	在对召回阶段不同算法给出的候选物品计算 CTR 预估时，需要两个东西：1、特征；2、权重	9](#_331)

[6\.1\.6\.	第一个是特征，就是用量化、向量的方式把一个用户和一个物品的成对组合表示出来。	9](#_332)

[6\.1\.7\.	第二个是权重，每个特征都有一个权重，权重就是特征的话事权。	9](#_333)

[6\.1\.8\.	特征工程 \+ 线性模型，是模型融合、CTR 预估等居家旅行必备。	9](#_334)

[6\.1\.9\.	权重的学习主要看两个方面：损失函数的最小化，就是模型的偏差是否足够小；另一个就是模型的正则化，就是看模型的方差是否足够小；	9](#_335)

[6\.1\.10\.	树模型最原始的是决策树，简称 DT。最常见的就是随机森林，简称 RF，和梯度提升决策树，简称 GBDT。	9](#_336)

[6\.2\.	14\.一网打尽协同过滤、矩阵分解和线性模型	9](#_170)

[6\.2\.1\.	另一种常用来做 CTR 预估的模型，因子分解机。	9](#_337)

[6\.3\.	15\.深度和宽度兼具的融合模型Wide and Deep	9](#_171)

[6\.3\.1\.	CTR 预估的常见做法就是广义线性模型，如 Logistic Regression，然后再采用特征海洋战术，就是把几乎所有的精力都放在搞特征上：挖掘新特征、挖掘特征组合、寻找新的特征离散方法等等。	9](#_338)

[6\.3\.2\.	搜索由检索和排序构成。推荐系统也有召回和排序两部构成，	9](#_339)

[6\.3\.3\.	一个深度神经网络由输入层，隐藏层，输出层构成。	10](#_340)

[6\.3\.4\.	所谓深度学习，就是深度神经网络，就是有不止一层的隐藏层存在。层数越多，非线性越强，模型越复杂。	10](#_341)

[7\.	原理篇：MAB问题	10](#_161)

[7\.1\.	16\.简单却有效的Bandit算法	10](#_172)

[7\.1\.1\.	建立连接可以理解成：为用户匹配到最佳的物品；但也有另一个理解就是，在某个时间某个位置为用户选择最好的物品。	10](#_368)

[7\.1\.2\.	Bandit 算法来源于人民群众喜闻乐见的赌博学	10](#_369)

[7\.1\.3\.	Bandit 算法有汤普森采样，UCB 算法，Epsilon 贪婪	10](#_370)

[7\.2\.	17\.结合上下文信息的Bandit算法	10](#_173)

[7\.2\.1\.	LinUCB 算法做了一个假设：一个物品被选择后推送给一个用户，其收益和特征之间呈线性关系。	10](#_371)

[7\.2\.2\.	LinUCB 算法有一个很重要的步骤，就是给用户和物品构建特征，也就是刻画上下文。	10](#_372)

[7\.2\.3\.	LinUCB，它有这么几个优点：1、由于加入了特征，所以收敛比 UCB 更快，也就是比 UCB 更快见效；2、各个候选臂之间参数是独立的，可以互相不影响地更新参数；3、由于参与计算的是特征，所以可以处理动态的推荐候选池，编辑可以增删文章；	10](#_373)

[7\.2\.4\.	LinUCB 以及所有的 Bandit 算法都有个缺点：同时处理的候选臂数量不能太多，不超过几百个最佳。	10](#_374)

[7\.2\.5\.	LinUCB 只是一个推荐框架，可以将这个框架应用在很多地方，比如投放广告，为用户选择兴趣标签	10](#_375)

[7\.3\.	18\.如何将Bandit算法与协同过滤结合使用	10](#_174)

[7\.3\.1\.	Bandit 算法是一种不太常用在推荐系统的算法，究其原因，是它能同时处理的物品数量不能太多。	11](#_376)

[7\.3\.2\.	但是，在冷启动和处理 EE 问题时，Bandit 算法简单好用，值得一试。	11](#_377)

[8\.	原理篇：深度学习	11](#_162)

[8\.1\.	19\.深度学习在推荐系统中的应用有哪些	11](#_175)

[8\.1\.1\.	深度学习也就是深度神经网络，并不是一个全新的概念	11](#_342)

[8\.1\.2\.	对本质属性的挖掘，有两个好处：1、可以更加高效且真实地反映出事物本身的样子；2、可以更加高效真实地反映出用户和物品之间的连接	11](#_343)

[8\.1\.3\.	深度学习可以帮助推荐系统的地方。第一个叫做 Embedding，就是嵌入，第二个叫做 Predicting，就是预测。	11](#_344)

[8\.1\.4\.	矩阵分解得到的隐因子向量就是一种 Embedding，Word2vec 也是一种 Embedding	11](#_345)

[8\.1\.5\.	从 YouTube 的推荐系统可以看出，深度学习主要贡献在于特征表达学习和排序模型上。	11](#_346)

[8\.2\.	20\.用RNN构建个性化音乐播单	11](#_176)

[8\.2\.1\.	有一些矩阵分解算法考虑了时间属性，比如 Time\-SVD；	11](#_347)

[8\.2\.2\.	循环神经网络，也常被简称为 RNN，是一种特殊的神经网络	11](#_348)

[8\.2\.3\.	你就需要记住一点：链式规则，一路求导下去。	11](#_349)

[8\.2\.4\.	交叉熵是模型的目标函数，训练模型的目的就是要最小化它，也就是“误差反向传播”的“误差”。	11](#_350)

[8\.2\.5\.	循环神经网络和普通神经网络相比，就是在两个时刻的隐藏状态之间多了网络连接。	12](#_351)

[9\.	原理篇：其他应用算法	12](#_163)

[9\.1\.	21\.构建一个科学的排行榜算法	12](#_177)

[9\.1\.1\.	所谓智能，就是带有学习性质，能够和复杂的用户端形成互动，在互动过程中，算法参数得到更新和进化。	12](#_352)

[9\.1\.2\.	排行榜到底有哪些用处呢：1、排行榜可以作为解决新用户冷启动问题的推荐策略；2、排行榜可以作为老用户的兴趣发现方式；3、排行榜本身就是一个降级的推荐系统	12](#_353)

[9\.1\.3\.	最简单的排行榜，就是直接统计某种指标，按照大小去排序。	12](#_354)

[9\.1\.4\.	不靠谱的原因在于以下的几个问题：1、非常容易被攻击，也就是被刷榜；2、马太效应会一直存在，除非强制替换，否则一些破了记录的物品会一直占据在榜单中；3、不能反映出排行榜随着时间的变化	12](#_355)

[9\.1\.5\.	另一个考虑时间因素的排行榜算法是牛顿冷却定律。	12](#_356)

[9\.1\.6\.	一个经典的好评率估算公式，叫做威尔逊区间，超级复杂的公式	12](#_357)

[9\.1\.7\.	这个公式的好处是：所有的物品，不论有多少人为它评分，都可以统一地计算出一个合理的平均分数，它已经被国内外电影评分网站采纳在自己的排行榜体系中	12](#_358)

[9\.2\.	22\.使用的加权采样算法	12](#_178)

[9\.2\.1\.	按照权重采样一部分标签来使用，这样做的好处当然很明显：1、大大减少召回时的计算复杂度；2、可以保留更多的用户标签；3、每次召回计算时还能有所变化；	12](#_359)

[9\.2\.2\.	加权采样有两种情况：一种是能够已知全部样本的个数；另一种是不知道总体样本有多大，或者总量有多大，以至于你不愿意全部遍历之后再输出采样结果	13](#_360)

[9\.3\.	23\.推荐候选池的去重策略	13](#_179)

[9\.3\.1\.	在推荐系统中，有一个刚需就是去重。主要是在两个地方：一个是内容源去重，另一个是不重复给用户推荐。	13](#_361)

[9\.3\.2\.	对内容做重复检测，直观的思路是分词，然后提取关键词，再两两计算词向量之间的距离，距离小于一定阈值后就判定为重复	13](#_362)

[9\.3\.3\.	另一个需求是在内容阅读类推荐场景下，给用户推荐的内容不要重复，推荐过的内容就不再出现在推荐候选集中。	13](#_363)

[9\.3\.4\.	Simhash 为每一个内容生成一个整数指纹，其中的关键是把每个词哈希成一个整数，这一步常常采用 Jenkins 算法。	13](#_364)

[9\.3\.5\.	实际上，解决这类看一个字符串在不在一个集合中的问题，有一个有点老但很好用的做法，就是 Bloomfilter，有时候也被称为布隆过滤器。	13](#_365)

[9\.3\.6\.	布隆过滤器的原理也要用到哈希函数。它包含两部分：一个很长的二进制位向量，和一系列哈希函数	13](#_366)

[9\.3\.7\.	只是哈希函数的结果在两个算法中有不同的处理手段，Simhash 是加权，Bloomfilter 则是用来做寻址。	13](#_367)

[10\.	工程篇：常见架构	13](#_164)

[10\.1\.	24\.典型的信息流架构是什么样的	13](#_180)

[10\.1\.1\.	信息流是推荐系统应用中的当红炸子鸡，它表现形式有很多：社交网络的动态信息流、新闻阅读的图文信息流、短视频信息流等等。	13](#_228)

[10\.1\.2\.	传统的信息流产品知识简单按照时间排序，而被推荐系统接管后的信息流逐渐成为主流，按照兴趣排序，也叫作“兴趣 feed”。	14](#_229)

[10\.1\.3\.	要实现一个信息流，可以划分为两个子问题：1、如何实现一个按照时间顺序排序的信息流系统？2、如何给信息流内容按照兴趣重排序？	14](#_230)

[10\.1\.4\.	整体的框架划分成几个大的模块：日志收集、内容发布、机器学习、信息流服务、监控。	14](#_231)

[10\.1\.5\.	信息流的基本数据有三个：用户（User）、内容（Activity）和关系（Connection）。	14](#_232)

[10\.1\.6\.	用于表达 Activity 的元素有相应的规范，叫作 Atom。根据 Atom 规范的定义，一条 Activity 包含的元素有：Time、Actor、Verb、Object、Target、Title、Summary。	14](#_233)

[10\.1\.7\.	在数据存储上可以选择的工具有下面的几种：Activity 存储可以采用 MySQL、Redis、Cassandra 等；Connection 存储可以采用 MySQL；User 存储可以采用 MySQL。	14](#_234)

[10\.1\.8\.	把动态内容出现在受众的信息流中，直觉上是这样实现的：1、获取用户所有连接的重点\(如好友、关注对象、兴趣标签\)；2、获取这些连接终点\(关注对象\)产生的新内容\(Activity\)；3、按照某个指标排序后输出。	14](#_235)

[10\.1\.9\.	拉模式就是当用户访问时，信息流服务才会去相应的发布源拉取内容到自己的 feed 区来，这是一个阻塞同步的过程。	14](#_236)

[10\.1\.10\.	推模式的实现是系统为每一个用户单独开辟一个信息流存储区域，用于接收推送的内容。	14](#_237)

[10\.1\.11\.	简单的结合方案：对于活跃度高的用户，使用推模式；对于活跃度没有那么高的用户，使用拉模式；对于热门的内容生产者，缓存其最新的N条内容，用于不同场景下的拉取。	14](#_238)

[10\.1\.12\.	对于信息流的产生和存储可以选择的工具有：用户信息流的存储可以采用Redis等KV数据库，使用uid作为key；信息流推送的任务队列可以采用Celery等成熟框架。	15](#_239)

[10\.1\.13\.	避免陷入两个误区：1、没有目标；2、人工量化	15](#_240)

[10\.1\.14\.	目前信息流采用机器学习排序，以提升类似互动率，停留时长等指标，这已经成为共识。	15](#_241)

[10\.1\.15\.	信息流的特征有三类：1、用户特征；2、内容特征；3、其他特征（刷新时间、所处页面等）	15](#_242)

[10\.1\.16\.	信息流是一个数据驱动的系统，既要通过历史数据来寻找算法的最优参数，又要通过新的数据验证排序效果。	15](#_243)

[10\.1\.17\.	数据流管道要使用的相关数据可能有：1、互动行为数据；2、曝光内容；3、互动行为与曝光的映射关系；4、用户画像内容；5、信息流的内容分析数据；	15](#_244)

[10\.1\.18\.	数据的管道可以分成三块：1、生成训练样本，可离线；2、排序模型训练，可离线；3、模型服务化，实时服务。	15](#_245)

[10\.2\.	25\.Netflix个性化推荐架构	15](#_181)

[10\.2\.1\.	一个好的推荐系统架构应该具有这些特质：1、实时响应请求；2、及时、准确、全面记录用户反馈；3、可以优雅降级；4、快速实验多种策略。	15](#_246)

[10\.2\.2\.	整体架构可以分为三个层级：1、离线：不用实时数据，不提供实时服务；2、近线：使用实时数据，不保证实时服务；3、在线：使用实时数据，要保证实时服务	15](#_247)

[10\.2\.3\.	在线层的触发时机是当用户发出请求，也就是用户进入一个推荐场景，推荐位等着展示推荐结果时	15](#_248)

[10\.2\.4\.	哪些计算逻辑适合放在在线层：1、简单的算法逻辑；2、模型的预测阶段；3、商业目标相关的过滤或者调权逻辑；4、场景有关的一些逻辑；5、互动性强的一些算法；	16](#_249)

[10\.2\.5\.	离线层就是躲在推荐系统的大后方，批量、周期性地执行一些计算任务	16](#_250)

[10\.2\.6\.	离线阶段主要面对的数据源就是 Hadoop，实质上是 HDFS。	16](#_251)

[10\.2\.7\.	离线阶段的任务主要是两类：模型训练和推荐结果计算。	16](#_252)

[10\.2\.8\.	近线层结合了离线层和在线层的好处，摒弃了两者的不足。	16](#_253)

[10\.2\.9\.	常用的流计算框架有 Storm，Spark Streaming，FLink 等	16](#_254)

[10\.2\.10\.	简化的架构：1、完全舍弃掉近线层；2、避免使用分布式系统	16](#_255)

[10\.3\.	26\.总览推荐架构和搜索、广告的关系	16](#_182)

[10\.3\.1\.	应对信息过载重担先后交给了两种主要形式，包括以搜索为代表的各种主动寻找信息的形式，以及以推荐为代表的各种被动接受信息的形式。	16](#_256)

[10\.3\.2\.	另外介于两者之间，还有一种商业化解决信息触达问题，就是广告系统	16](#_257)

[10\.3\.3\.	三者都是解决信息过滤问题的	16](#_258)

[10\.3\.4\.	搜索，推荐和广告本质上都在解决信息过载的问题，各自解决的手段、目标不相同，各自诞生在产品生命周期不同阶段，以至于系统实现也不尽相同。	16](#_259)

[10\.3\.5\.	搜索更关注内容消费者，搜索要解决的是精确快速找到想要的结果，最重要的目标是降低延迟和提高相关性。	16](#_260)

[10\.3\.6\.	推荐系统不同于搜索引擎，用户使用搜索时目标明确，而使用推荐系统往往总会漫无目的	17](#_261)

[10\.3\.7\.	搜索和推荐都是为人找信息，而广告是为信息找人。	17](#_262)

[10\.3\.8\.	广告系统关注的是商业利益最大化，精准和相关都不是终极目的，只是其中的一个手段。	17](#_263)

[10\.3\.9\.	架构抽象一下三者的需求共性：本质上都是在匹配，匹配用户的兴趣和需求，但匹配的目标，条件和策略不尽相同。	17](#_264)

[10\.3\.10\.	进一步抽象，分为三步：过滤候选、排序候选、个性化输出。	17](#_265)

[11\.	工程篇：常见模块	17](#_165)

[11\.1\.	27\.巧妇难为无米之炊：数据采集关键要素	17](#_183)

[11\.1\.1\.	数据采集，按照用途分类又有三种：1、报表统计；2、数据分析；3、机器学习	17](#_266)

[11\.1\.2\.	给推荐系统收集日志这件事，依次要讨论的是：日志的数据模型，收集哪些日志，用什么工具收集，收集的日志怎么存储。	17](#_267)

[11\.1\.3\.	所谓数据模型，其实就是把数据归类。	17](#_268)

[11\.1\.4\.	就推荐系统而言，推荐系统要做的事情就是预测那些最终会建立的人和物之间的连接，依赖的是已有的连接，以及人和物的属性	17](#_269)

[11\.1\.5\.	后端收集业务日志好处：1、实时性；2、可及时更新；3、开发简单	17](#_270)

[11\.2\.	28\.让你的推荐系统反应更快：实时推荐	17](#_184)

[11\.2\.1\.	推荐系统从业者所追求的三个要素：捕捉兴趣要更快，指标要更高，系统要更健壮。	17](#_271)

[11\.2\.2\.	一个处在第三层次的实时推荐，需要满足三个条件：1、数据实时进来；2、数据实时计算；3、结果及时更新	18](#_272)

[11\.2\.3\.	Kafka 以生产者消费者的模式吞吐数据	18](#_273)

[11\.2\.4\.	常见的流计算平台有 Twitter 开源的 Storm，“Yahoo！”开源的 S4，还有 Spark 中的 Streaming。	18](#_274)

[11\.3\.	29\.让数据驱动落地，你需要一个实验平台	18](#_185)

[11\.3\.1\.	要做到数据驱动，就要做到两点：第一点是数据，第二点是驱动	18](#_275)

[11\.3\.2\.	要做到驱动，需要一个 AB 实验平台	18](#_276)

[11\.3\.3\.	互联网实验，需要三个要素：1、流量；2、参数；3、结果	18](#_277)

[11\.3\.4\.	所谓重叠实验，就是一个流量从进入产品服务，到最后返回结果呈现给用户，中间设置了好几个检查站，每个检查站都在测试某些东西，这样同时做多组实验就是重叠实验。	18](#_278)

[11\.3\.5\.	重叠实验最大的问题是怎么避免流量偏置，引入三个概念：1、域；2、层；3、桶	18](#_279)

[11\.3\.6\.	流量分配方式：1、Cookie \+ 层ID取模；2、完全随机；3、用户ID\+层ID取模；4、Cookie\+日期取模	18](#_280)

[11\.4\.	30\.推荐系统服务化、存储选型及API设计	18](#_281)

[11\.4\.1\.	提供一个在线服务，需要两个关键元素：数据库和 API。	18](#_282)

[11\.4\.2\.	特征数据有两种，一种是稀疏的，一种是稠密的，稀疏的特征常见就是文本类特征，用户标签之类的，稠密的特征则是各种隐因子模型的产出参数。	18](#_283)

[11\.4\.3\.	特征数据又常常要以两种形态存在：一种是正排，一种是倒排。	19](#_284)

[11\.4\.4\.	正排需要用列式数据库存储，倒排索引需要用 KV 数据库存储。前者最典型的就是 HBase 和 Cassandra，后者就是 Redis 或 Memcached。	19](#_285)

[11\.4\.5\.	ElasticSearch。这原本是一个构建在开源搜索引擎 Lucene 基础上的分布式搜索引擎，也常用于日志存储和分析，但由于它良好的接口设计，扩展性和尚可的性能，也常常被采用来做推荐系统的简单第一版，直接承担了存储和计算的任务。	19](#_286)

[11\.4\.6\.	Cassandra 在数据库的 CAP 理论中可以平滑权衡，而 HBase 则是强一致性，并且 Cassandra 读写性能优于 HBase，因此 Cassandra 更适合推荐系统，	19](#_287)

[11\.4\.7\.	还有一种存储模式，就是键值对内存数据库，这当然首推 Redis。	19](#_288)

[11\.4\.8\.	以下场景中常常见到 Redis 的：1、消息队列；2、优先队列；3、模型参数	19](#_289)

[11\.4\.9\.	Redis 被人诟病的就是不太高可用	19](#_290)

[11\.4\.10\.	API 有两大类，一类数据录入，另一类是推荐服务	19](#_291)

[11\.4\.11\.	1\. 猜你喜欢；2\. 相关推荐；3\. 热门排行榜	19](#_292)

[12\.	工程篇：效果保证	19](#_166)

[12\.1\.	31\.推荐系统的测试方法及常见指标	19](#_186)

[12\.1\.1\.	推荐系统的测试方法有四种： 业务规则扫描、离线模拟测试、在线对比测试、用户访谈。	19](#_293)

[12\.1\.2\.	检测系统到底有多好，其实，也有两类，一类是深度类，一类是广度类。	20](#_297)

[12\.1\.3\.	深度类指标就指在检测系统在这两个工作上是否做得到位，有针对离线模型的指标，也有在线的指标：1、评分准确度；2、排序；3、分类准确度；4、覆盖率；5、失效率；6、新颖性；7、更新率	20](#_294)

[12\.1\.4\.	通常检测推荐系统的商业指标有：点击率，转化率。	20](#_295)

[12\.1\.5\.	衡量推荐系统是否健康的指标常用的有三个：1、个性化；2、基尼系数；3、多样性	20](#_296)

[12\.1\.6\.	推荐系统作为一种 AI 系统，其测试方法不完全相同于传统软件功能测试。	20](#_298)

[12\.2\.	32\.道高一尺魔高一丈：推荐系统的攻防	20](#_187)

[12\.2\.1\.	被研究得最为彻底的就是针对协同过滤的攻防：一方面是协同过滤本身就应用广泛，另一方面是针对协同过滤的攻击容易生效。	20](#_299)

[12\.2\.2\.	所以攻击协同过滤，核心问题在于如何操纵选民。选民有两种，一种是用户，一种是物品，前者是基于用户的协同过滤所需要的，后者是基于物品的协同过滤所需要的。	20](#_300)

[12\.2\.3\.	通常的手段就是，批量制造假用户资料，并装作是与被欺骗用户兴趣相投的人。托攻击或者 Shilling Attacks，托也就是水军。	20](#_301)

[12\.2\.4\.	攻击手段包含这些元素：1、目标物品，就是攻击方要扶持或者打压的那个物品；2、助攻物品，就是用来构造假的相似用户所需要的物品；3、陪跑物品，就是用来掩饰造假的物品	20](#_302)

[12\.2\.5\.	分段攻击就是想办法把目标物品引入到某个群体中，做法就是攻击者先圈定好用户群体，再列出这个群体肯定喜欢的物品集合，然后同时用假用户给目标物品和这批物品集合评分，做法类似热门攻击。	20](#_303)

[12\.2\.6\.	防护手段按照层级，可以分为下面几种：1、平台级；2、数据级；3、算法级	21](#_304)

[12\.2\.7\.	平台级：一面是提高批量注册用户的成本，另一方面是产品教育用户积极参与，并提供真实的反馈	21](#_305)

[12\.2\.8\.	数据级：数据级别防护重点是从数据中识别出哪些数据是假的，哪些用户是被操纵的选民。通常是采用机器学习思路，标注一批假用户或假反馈数据，训练分类器，在线上识别出反馈。	21](#_306)

[12\.2\.9\.	算法级：算法级别就是在推荐算法设计时，要根据情况做一些改进和选择	21](#_307)

[12\.2\.10\.	改进方向包括下面几种：1、引入用户质量，限制对于低质量的用户参与计算，或者限制新用户参与计算；2、限制每个用户的投票权重，即在计算用户相似度时引入较重的平滑因子，使得用户之间的相似度不容易出现过高的值	21](#_308)

[12\.3\.	33\.和推荐系统有关的开源工具及框架介绍	21](#_188)

[12\.3\.1\.	文本分析相关的工作就是将非结构化的文本转换为结构化。主要的工作就是三类：1、主题模型；2、词嵌入；3、文本分类；	21](#_309)

[12\.3\.2\.	基于用户、基于物品的协同过滤，矩阵分解，都依赖对用户物品关系矩阵的利用。常常要涉及的工作有下面几种：1、KNN相似度计算；2、SVD矩阵分解；3、SVD\+\+矩阵分解；4、ALS矩阵分解；5、BPR矩阵分解；6、低维稠密向量近邻搜索	21](#_310)

[12\.3\.3\.	模型融合这部分，有线性模型、梯度提升树模型。	21](#_311)

[12\.3\.4\.	所谓完整的推荐系统是指：包含推荐算法实现、存储、接口。	21](#_312)

[12\.3\.5\.	倾向于选择各个模块的开源项目，再将其组合集成为自己的推荐系统，这样的好处有下面几种：1、单个模块开源项目容易入手，学习成本低，性能好；2、自己组合后更容易诊断问题，不需要的不用开发；3、单个模块的性能和效果更有保证。	22](#_313)

[13\.	产品篇	22](#_167)

[13\.1\.	34\.推荐系统在互联网产品商业链条中的地位	22](#_189)

[13\.1\.1\.	推荐系统处理的是信息，它的主要作用是在信息生产方和信息消费方搭建起桥梁。	22](#_314)

[13\.1\.2\.	信息经济其实就是注意力经济，而推荐系统就是留住注意力的重要手段。	22](#_315)

[13\.1\.3\.	注意力有个特点：总量有限。随着信息越来越丰富，注意力越来越稀缺。	22](#_316)

[13\.1\.4\.	个人把注意力定义为：内容被消耗的加速度与平台内容复杂度的乘积。	22](#_317)

[13\.1\.5\.	制定一些提升平台剩余注意力的策略：1、内容创作适当少倾注注意力；2、提升内容难度；3、提高单用户消耗加速度；4、提高活跃用户数	22](#_318)

[13\.1\.6\.	打造一个推荐系统的成本分布在这几个地方：1、团队成本；2、硬件成本；3、机会成本；	22](#_319)

[13\.2\.	35\.说说信息流的前世今生	22](#_190)

[13\.2\.1\.	最厉害的注意力存储器就是信息流，尤其是个性化信息流，也叫做兴趣 Feed，	22](#_320)

[13\.2\.2\.	NewsFeed 的成功，验证了几个常识：1、数据驱动比舆论驱动靠谱，别听人们嘴上是怎么说的，只看人们是如何行动的；2、窥探隐私，向群体靠拢，害怕孤单是普遍人性，把新鲜事公开这件事验证了这一点；3、注意力非常有限，用推荐系统的方法更好地储存注意力，基于兴趣的信息流验证了这一点。	23](#_321)

[13\.2\.3\.	内容源是信息流的一种重要基础设施，要想尽办法建设好。内容源应该考虑下面几种：1、质量；2、多样性；3、质量	23](#_322)

[13\.2\.4\.	NewsFeed 还有另一个配套设施，那就是吸金的广告系统	23](#_323)

[13\.3\.	36\.组件推荐团队及工程师的学习路径	23](#_191)

[13\.3\.1\.	定义团队的角色：算法工程师，软件开发工程师，其他非技术角色	23](#_324)

[13\.3\.2\.	个人成长具备三个核心素质：1、有较强的工程能力；2、有较强的理论基础；3、有很好的可视化思维	23](#_325)

[13\.3\.3\.	非典型工程师的加分项：1、学习能力；2、沟通能力；3、表达能力	23](#_326)

[14\.	结束语与参考阅读	23](#_168)

# <a id="_____2"></a><a id="_103"></a>开篇词

## <a id="_____4"></a><a id="_104"></a>用知识去对抗技术不平等

### <a id="_____6"></a><a id="_119"></a>但凡AI类的落地，都需要具备这几个基本元素才行：数据、算法、场景、计算力

### <a id="_____8"></a><a id="_120"></a>有一个趋势确信无疑：世界在向网状发展，万事万物倾向于相互连接构成复杂网络

# <a id="_____10"></a><a id="_101"></a>概念篇

## <a id="_____12"></a><a id="_102"></a>1\.你真的需要个性化推荐系统吗？

### <a id="_____14"></a><a id="_121"></a>什么是推荐系统？按照维基百科的定义：它是一种信息过滤系统，手段是预测用户（User）对物品（Item）的评分与偏好

### <a id="_____16"></a><a id="_122"></a>推荐系统能做什么？推荐系统可以把那些最终会在用户（User）和物品（Item）之间产生的连接提前找出来

### <a id="_____18"></a><a id="_123"></a>推荐系统需要什么？需要已经存在的连接，从已有的连接去预测未来的连接

### <a id="_____20"></a><a id="_124"></a>一个简单的指标，用于判断是不是需要推荐系统：connection的变化量/（user的变量量\*item的变化量）

### <a id="_____22"></a><a id="_125"></a>搭建一个推荐系统的前期投入不小，需要：组建团队、购置计算资源、积累数据、花费时间优化

## <a id="_____24"></a><a id="_105"></a>2\.个性化推荐系统有哪些绕不开的经典问题？

### <a id="_____26"></a><a id="_126"></a>推荐系统的预测问题模式，从达成的连接目标角度区分有两大类：评分预测、行为预测

### <a id="_____28"></a><a id="_127"></a>评分预测相关算法模型研究的兴盛，最大的助攻是Netflix举办的推荐算法大赛

### <a id="_____30"></a><a id="_128"></a>推荐系统预测行为方式有很多，常见的有两种：直接预测行为本身产生的概率，和预测物品的相对排序

### <a id="_____32"></a><a id="_129"></a>把每一个推荐给用户的物品按照“会否点击”二分类，构建分类模型，预估其中一种分类的概率，就是CTR预估

### <a id="_____34"></a><a id="_130"></a>各大厂高度重视隐式反馈，归纳起来有以下几点原因：1、数据比显式反馈更加稠密；2、隐式反馈更代表用户的真实想法；3、隐式反馈常常和模型的目标函数关联密切

### <a id="_____36"></a><a id="_131"></a>推荐系统的几个顽疾：1、冷启动问题；2、探索与利用问题；3、安全问题

## <a id="_____38"></a><a id="_106"></a>3\.这些你必须应该具备的思维模式

### <a id="_____40"></a><a id="_132"></a>四个关键的元素：1、UI和UE；2、数据；3、领域知识；4、算法

### <a id="_____42"></a><a id="_133"></a>一种对算法的常见误会：短期高估，长期低估

### <a id="_____44"></a><a id="_134"></a>两种思维模式：目标思维和不确定性思维

### <a id="_____46"></a><a id="_135"></a>目标思维背后是“量化一切”的价值取向

### <a id="_____48"></a><a id="_136"></a>不确定性思维就是：不用因果逻辑严丝合缝地提前推演，而是用概率的眼光去看结果

# <a id="_____50"></a><a id="_107"></a>原理篇：内容推荐

## <a id="_____52"></a><a id="_108"></a>4\.画鬼容易画人难：用户画像的“能”和“不能”

### <a id="_____54"></a><a id="_137"></a>用户画像不是推荐系统的目的，而是在构建推荐系统的过程中产生的一个关键环节的副产品

### <a id="_____56"></a><a id="_138"></a>通常大型推荐系统一般都分为召回和排序两个阶段

### <a id="_____58"></a><a id="_139"></a>建立用户画像的关键因素：第一个是维度，第二个是量化

### <a id="_____60"></a><a id="_140"></a>按照对用户向量化的手段来分，用户画像构建方法分成三类：第一类是查户口；第二类是堆数据；第三类是黑盒子

### <a id="_____62"></a><a id="_141"></a>查户口就是直接使用原始数据作为用户画像的内容；堆数据就是堆积历史数据，做统计工作；黑盒子就是用机器学习方法，学习出人类无法直观理解的稠密向量

## <a id="_____64"></a><a id="_109"></a>5\.从文本到用户画像有多远

### <a id="_____66"></a><a id="_142"></a>文本数据是互联网产品中最常见的信息表达形式，数量多、处理快、存储小

### <a id="_____68"></a><a id="_143"></a>要用物品和用户的文本信息构建出一个基础版本的用户画像，大致需要做这些事：1、把所有非结构化的文本结构化，去粗取精，保留关键信息；2、根据用户行为数据把物品的结构化结果传递给用户，与用户自己的结构信息合并

### <a id="_____70"></a><a id="_144"></a>利用成熟的NLP算法分析得到的信息有下面几种：1、关键词提取；2、实体识别；3、内容分类；4、文本；5、主题模型；6、嵌入

### <a id="_____72"></a><a id="_145"></a>标签选择，一种简单粗暴的办法是直接把用户产生过行为的物品标签累积在一起

### <a id="_____74"></a><a id="_146"></a>另一种思路是把用户对物品的行为，消费或者没有消费看成一个分类问题

### <a id="_____76"></a><a id="_147"></a>特征选择问题最常用的是两个方法：卡方检验（CHI）和信息增益（IG）

### <a id="_____78"></a><a id="_148"></a>CHI就是卡方检验，本身是一种特征选择方法

### <a id="_____80"></a><a id="_149"></a>IG即Information Gain，信息增益，也是一种有监督的关键词选择方法，也需要有标注信息

### <a id="_____82"></a><a id="_150"></a>信息增益应用最广就是数据挖掘中的决策树分类算法，经典的决策树分类算法挑选分裂节点时就是计算各个属性的信息增益，始终挑选信息增益最大的节点作为分裂节点

### <a id="_____84"></a><a id="_151"></a>卡方检验和信息增益不同之处在于：前者是针对每一个行为单独筛选一套标签出来，后者是全局统一筛选

## <a id="_____86"></a><a id="_110"></a>6\.超越标签的内容推荐系统

### <a id="_____88"></a><a id="_152"></a>基于内容的推荐系统，标签只是很小一部分

### <a id="_____90"></a><a id="_153"></a>要把基于内容的推荐做好，需要做好“抓、洗、挖、算”四门功课

### <a id="_____92"></a><a id="_154"></a>抓：抓取数据补充内容源，洗：清洗冗余的内容、垃圾内容、政治色情等敏感内容，挖：对内容做深入的挖掘，算：匹配用户的兴趣和物品的属性，计算出更合理的相关性

### <a id="_____94"></a><a id="_155"></a>典型基于内容推荐的框架图：内容这一端，内容源经过内容分析，得到结构化的内容库和内容模型，也就是物品画像。用户这一端，用户看过推荐列表后，会产生用户行为数据，结合物品画像，经过用户分析得到用户画像

### <a id="_____96"></a><a id="_156"></a>内容分析的产出有两个：1、结构化内容库，2、内容分析模型

### <a id="_____98"></a><a id="_157"></a>结构化的内容库，最重要的用途是结合用户反馈行为去学习用户画像，容易被忽略的是第二个用途，在内容分析过程中得到的模型

### <a id="_____100"></a><a id="_158"></a>内容推荐的算法，一种最典型的场景：提高某种行为的转化率，如点击、收藏、转发等

### <a id="_____102"></a><a id="_159"></a>基于内容的推荐一般是推荐系统的起步阶段，而且会持续存在，它的重要性不可取代

# <a id="_____104"></a><a id="_111"></a>原理篇：近邻推荐

## <a id="_____106"></a><a id="_112"></a>7\.人以群分，你是什么人就看到什么世界

### <a id="_____108"></a><a id="_192"></a>协同过滤是一个比较大的算法范畴，通常划分为两类：1、基于记忆的协同过滤；2、基于模型的协同过滤；

### <a id="_____110"></a><a id="_193"></a>背后的思想：先根据历史消费行为帮你找到一群和你口味很相似的用户；然后根据这些和你很相似的用户再消费了什么新的、你没有见过的物品，都推荐给你

### <a id="_____112"></a><a id="_194"></a>核心是用户物品的关系矩阵

### <a id="_____114"></a><a id="_195"></a>典型的稀疏矩阵存储格式：CSR、COO

### <a id="_____116"></a><a id="_196"></a>通常降低相似度计算复杂度的办法有两种：1、对向量采样计算；2、向量化计算

### <a id="_____118"></a><a id="_197"></a>一般来说，中小型公司如果没有特别必要的话，不要用分布式计算；拆分Map Reduce任务也不一定非要用Hadoop或者Spark实现

### <a id="_____120"></a><a id="_198"></a>改进主要集中在用户对物品的喜欢程度上：1、惩罚对热门物品的喜欢程度；2、增加喜欢程度的时间衰减

### <a id="_____122"></a><a id="_199"></a>基于用户的协同过滤有两个产出：1、相似用户列表；2、基于用户的推荐结果

## <a id="_____124"></a><a id="_113"></a>8\.解密“看了又看”和“买了又买”

### <a id="_____126"></a><a id="_200"></a>基于物品的协同过滤算法诞生与1998年，是由亚马逊首先提出的

### <a id="_____128"></a><a id="_201"></a>基本步骤：1、构建用户物品的关系矩阵；2、两两计算行向量之间的相似度；3、根据推荐场景不同，产生推荐结果

### <a id="_____130"></a><a id="_202"></a>计算物品的相似度，一般选择余弦相似度

### <a id="_____132"></a><a id="_203"></a>通常的改进方向有两种：1、物品中心化；2、用户中心化

### <a id="_____134"></a><a id="_204"></a>计算推荐结果：第一种属于TopK推荐，类似“猜你喜欢”；第二种属于相关推荐

### <a id="_____136"></a><a id="_205"></a>Slope One算法计算的不是物品之间的相似度，而是计算的物品之间的距离，相似度的反面

## <a id="_____138"></a><a id="_114"></a>9\.协同过滤中的相似度计算方法有哪些

### <a id="_____140"></a><a id="_206"></a>推荐算法分为两个门派，一个是机器学习派，另一个是相似度门派

### <a id="_____142"></a><a id="_207"></a>近邻推荐的核心就是相似度计算方法的选择

### <a id="_____144"></a><a id="_208"></a>在近邻推荐中，最常用的相似度是余弦相似度，除此之外还有欧式距离、皮尔逊相关度、自适应的余弦相似度、局部敏感哈希等

### <a id="_____146"></a><a id="_209"></a>欧式距离，是一个欧式空间下度量距离的方法，不适合布尔向量之间

### <a id="_____148"></a><a id="_210"></a>余弦相似度度量的是两个向量之间的夹角

### <a id="_____150"></a><a id="_211"></a>皮尔逊相关度，先对向量做了中心化，再计算余弦相似度，不适合用作计算布尔值向量之间相关度

### <a id="_____152"></a><a id="_212"></a>杰卡德相似度，是两个集合的交集元素个数在并集中所占的比例，是为布尔值向量私人定做的

### <a id="_____154"></a><a id="_213"></a>余弦相似度适用于评分数据，杰卡德相似度适合用于隐式反馈数据

# <a id="_____156"></a><a id="_115"></a>原理篇：矩阵分解

## <a id="_____158"></a><a id="_116"></a>10\.那些在Netflix Prize中大放异彩的推荐算法

### <a id="_____160"></a><a id="_214"></a>几点近邻模型的问题：1、物品之间存在相关性，信息量并不随着向量维度增加二线性增加；2、矩阵元素稀疏，计算结果不稳定，增减一个向量维度，导致近邻结果差异很大的情况存在

### <a id="_____162"></a><a id="_215"></a>矩阵分解，直观上来说简单，就是把原来的矩阵，近似分解成两个小矩阵的乘积，在实际推荐计算时不再使用大矩阵，而是使用分解得到的两个小矩阵

### <a id="_____164"></a><a id="_216"></a>SVD和矩阵分解不能划等号，因为除了SVD还有一些别的矩阵分解方法

### <a id="_____166"></a><a id="_217"></a>按照机器学习框架，一般就是考虑两个核心要素：1、损失函数；2、优化算法

### <a id="_____168"></a><a id="_218"></a>整个SVD的学习过程就是：1、准备好用户物品的评分矩阵，每一条评分数据看做一条训练样本；2、给分解后的U矩阵和V矩阵随机初始化元素值；3、用U和V计算预测后的分数；4、计算预测的分数和实际的分数误差；5、按照梯度下降的方向跟新U和V中的元素值；6、重复步骤3到5，知道达到停止条件

### <a id="_____170"></a><a id="_219"></a>在SVD中考虑时间因素，有几种做法：1、对评分按照时间加权，让久远的评分更趋紧平均值；2、对评分时间划分区间，不同呃时间区间分别学习出隐因子向量，使用时按照区间使用对应的隐因子向量来计算；3、对特殊的期间，如节日、周末等训练对应的隐因子向量

### <a id="_____172"></a><a id="_220"></a>SVD及其一些典型的改进方案分别是：1、考虑偏置信息；2、考虑隐式反馈和用户属性；3、考虑时间因素

## <a id="_____174"></a><a id="_117"></a>11\.Facebook是怎么为十亿人互相推荐好友的

### <a id="_____176"></a><a id="_221"></a>矩阵分解要将用户物品评分矩阵分解成两个小矩阵，一个矩阵是代表用户偏好的用户隐因子向量组成，另一个矩阵是代表物品语义主题的隐因子向量组成

### <a id="_____178"></a><a id="_222"></a>所以矩阵分解，所做的事就是矩阵填充

### <a id="_____180"></a><a id="_223"></a>几乎所有的及其学习训练中：偏差大的模型欠拟合，方差大的模型过拟合

### <a id="_____182"></a><a id="_224"></a>优化方法常用的选择有两个，一个是随机梯度下降（SGD），另一个是交替最小二乘（ALS）

### <a id="_____184"></a><a id="_225"></a>在实际应用中，交替最小二乘更常用一些

### <a id="_____186"></a><a id="_226"></a>Facebook提出了两个方法得到真正的推荐结果：1、利用一些专门设计的数据结构存储所有物品的隐因子向量，从而实现通过一个用户向量可以返回最相似的K个物品；2、拿着物品的隐因子向量先做聚类，海量的物品会减少为少量的聚类。然后再逐一计算用户和每个聚类中心的推荐分数，给用户推荐物品就变成了给用户推荐物品聚类

## <a id="_____188"></a><a id="_118"></a>12\.如果关注排序效果，那么这个模型可以帮到你

### <a id="_____190"></a><a id="_227"></a>有一个词叫做均方根误差，用于评价模型预测精准程度的

# <a id="_____192"></a><a id="_160"></a>原理篇：模型融合

## <a id="_____194"></a><a id="_169"></a>13\.经典模型融合方法：线性模型和输模型的组合拳

### <a id="_____196"></a><a id="_327"></a>推荐系统在技术实现上一般划分为三个阶段：挖掘、召回、排序。

### <a id="_____198"></a><a id="_328"></a>在召回阶段，其实就是各种简单的、复杂的推荐算法，比如说基于内容的推荐，会产生一些推荐结果，比如基于物品的协同过滤会产生一些结果，矩阵分解会产生一些结果，等等。

### <a id="_____200"></a><a id="_329"></a>模型融合的作用除了统一地方军阀，还有集中提升效果的作用。在机器学习中，有专门为融合而生的集成学习思想。

### <a id="_____202"></a><a id="_330"></a>一个典型的模型融合方案是：逻辑回归和梯度提升决策树组合

### <a id="_____204"></a><a id="_331"></a>在对召回阶段不同算法给出的候选物品计算 CTR 预估时，需要两个东西：1、特征；2、权重

### <a id="_____206"></a><a id="_332"></a>第一个是特征，就是用量化、向量的方式把一个用户和一个物品的成对组合表示出来。

### <a id="_____208"></a><a id="_333"></a>第二个是权重，每个特征都有一个权重，权重就是特征的话事权。

### <a id="_____210"></a><a id="_334"></a>特征工程 \+ 线性模型，是模型融合、CTR 预估等居家旅行必备。

### <a id="_____212"></a><a id="_335"></a>权重的学习主要看两个方面：损失函数的最小化，就是模型的偏差是否足够小；另一个就是模型的正则化，就是看模型的方差是否足够小；

### <a id="_____214"></a><a id="_336"></a>树模型最原始的是决策树，简称 DT。最常见的就是随机森林，简称 RF，和梯度提升决策树，简称 GBDT。

## <a id="_____216"></a><a id="_170"></a>14\.一网打尽协同过滤、矩阵分解和线性模型

### <a id="_____218"></a><a id="_337"></a>另一种常用来做 CTR 预估的模型，因子分解机。

## <a id="_____220"></a><a id="_171"></a>15\.深度和宽度兼具的融合模型Wide and Deep

### <a id="_____222"></a><a id="_338"></a>CTR 预估的常见做法就是广义线性模型，如 Logistic Regression，然后再采用特征海洋战术，就是把几乎所有的精力都放在搞特征上：挖掘新特征、挖掘特征组合、寻找新的特征离散方法等等。

### <a id="_____224"></a><a id="_339"></a>搜索由检索和排序构成。推荐系统也有召回和排序两部构成，

### <a id="_____226"></a><a id="_340"></a>一个深度神经网络由输入层，隐藏层，输出层构成。

### <a id="_____228"></a><a id="_341"></a>所谓深度学习，就是深度神经网络，就是有不止一层的隐藏层存在。层数越多，非线性越强，模型越复杂。

# <a id="_____230"></a><a id="_161"></a>原理篇：MAB问题

## <a id="_____232"></a><a id="_172"></a>16\.简单却有效的Bandit算法

### <a id="_____234"></a><a id="_368"></a>建立连接可以理解成：为用户匹配到最佳的物品；但也有另一个理解就是，在某个时间某个位置为用户选择最好的物品。

### <a id="_____236"></a><a id="_369"></a>Bandit 算法来源于人民群众喜闻乐见的赌博学

### <a id="_____238"></a><a id="_370"></a>Bandit 算法有汤普森采样，UCB 算法，Epsilon 贪婪

## <a id="_____240"></a><a id="_173"></a>17\.结合上下文信息的Bandit算法

### <a id="_____242"></a><a id="_371"></a>LinUCB 算法做了一个假设：一个物品被选择后推送给一个用户，其收益和特征之间呈线性关系。

### <a id="_____244"></a><a id="_372"></a>LinUCB 算法有一个很重要的步骤，就是给用户和物品构建特征，也就是刻画上下文。

### <a id="_____246"></a><a id="_373"></a>LinUCB，它有这么几个优点：1、由于加入了特征，所以收敛比 UCB 更快，也就是比 UCB 更快见效；2、各个候选臂之间参数是独立的，可以互相不影响地更新参数；3、由于参与计算的是特征，所以可以处理动态的推荐候选池，编辑可以增删文章；

### <a id="_____248"></a><a id="_374"></a>LinUCB 以及所有的 Bandit 算法都有个缺点：同时处理的候选臂数量不能太多，不超过几百个最佳。

### <a id="_____250"></a><a id="_375"></a>LinUCB 只是一个推荐框架，可以将这个框架应用在很多地方，比如投放广告，为用户选择兴趣标签

## <a id="_____252"></a><a id="_174"></a>18\.如何将Bandit算法与协同过滤结合使用

### <a id="_____254"></a><a id="_376"></a>Bandit 算法是一种不太常用在推荐系统的算法，究其原因，是它能同时处理的物品数量不能太多。

### <a id="_____256"></a><a id="_377"></a>但是，在冷启动和处理 EE 问题时，Bandit 算法简单好用，值得一试。

# <a id="_____258"></a><a id="_162"></a>原理篇：深度学习

## <a id="_____260"></a><a id="_175"></a>19\.深度学习在推荐系统中的应用有哪些

### <a id="_____262"></a><a id="_342"></a>深度学习也就是深度神经网络，并不是一个全新的概念

### <a id="_____264"></a><a id="_343"></a>对本质属性的挖掘，有两个好处：1、可以更加高效且真实地反映出事物本身的样子；2、可以更加高效真实地反映出用户和物品之间的连接

### <a id="_____266"></a><a id="_344"></a>深度学习可以帮助推荐系统的地方。第一个叫做 Embedding，就是嵌入，第二个叫做 Predicting，就是预测。

### <a id="_____268"></a><a id="_345"></a>矩阵分解得到的隐因子向量就是一种 Embedding，Word2vec 也是一种 Embedding

### <a id="_____270"></a><a id="_346"></a>从 YouTube 的推荐系统可以看出，深度学习主要贡献在于特征表达学习和排序模型上。

## <a id="_____272"></a><a id="_176"></a>20\.用RNN构建个性化音乐播单

### <a id="_____274"></a><a id="_347"></a>有一些矩阵分解算法考虑了时间属性，比如 Time\-SVD；

### <a id="_____276"></a><a id="_348"></a>循环神经网络，也常被简称为 RNN，是一种特殊的神经网络

### <a id="_____278"></a><a id="_349"></a>你就需要记住一点：链式规则，一路求导下去。

### <a id="_____280"></a><a id="_350"></a>交叉熵是模型的目标函数，训练模型的目的就是要最小化它，也就是“误差反向传播”的“误差”。

### <a id="_____282"></a><a id="_351"></a>循环神经网络和普通神经网络相比，就是在两个时刻的隐藏状态之间多了网络连接。

# <a id="_____284"></a><a id="_163"></a>原理篇：其他应用算法

## <a id="_____286"></a><a id="_177"></a>21\.构建一个科学的排行榜算法

### <a id="_____288"></a><a id="_352"></a>所谓智能，就是带有学习性质，能够和复杂的用户端形成互动，在互动过程中，算法参数得到更新和进化。

### <a id="_____290"></a><a id="_353"></a>排行榜到底有哪些用处呢：1、排行榜可以作为解决新用户冷启动问题的推荐策略；2、排行榜可以作为老用户的兴趣发现方式；3、排行榜本身就是一个降级的推荐系统

### <a id="_____292"></a><a id="_354"></a>最简单的排行榜，就是直接统计某种指标，按照大小去排序。

### <a id="_____294"></a><a id="_355"></a>不靠谱的原因在于以下的几个问题：1、非常容易被攻击，也就是被刷榜；2、马太效应会一直存在，除非强制替换，否则一些破了记录的物品会一直占据在榜单中；3、不能反映出排行榜随着时间的变化

### <a id="_____296"></a><a id="_356"></a>另一个考虑时间因素的排行榜算法是牛顿冷却定律。

### <a id="_____298"></a><a id="_357"></a>一个经典的好评率估算公式，叫做威尔逊区间，超级复杂的公式

### <a id="_____300"></a><a id="_358"></a>这个公式的好处是：所有的物品，不论有多少人为它评分，都可以统一地计算出一个合理的平均分数，它已经被国内外电影评分网站采纳在自己的排行榜体系中

## <a id="_____302"></a><a id="_178"></a>22\.使用的加权采样算法

### <a id="_____304"></a><a id="_359"></a>按照权重采样一部分标签来使用，这样做的好处当然很明显：1、大大减少召回时的计算复杂度；2、可以保留更多的用户标签；3、每次召回计算时还能有所变化；

### <a id="_____306"></a><a id="_360"></a>加权采样有两种情况：一种是能够已知全部样本的个数；另一种是不知道总体样本有多大，或者总量有多大，以至于你不愿意全部遍历之后再输出采样结果

## <a id="_____308"></a><a id="_179"></a>23\.推荐候选池的去重策略

### <a id="_____310"></a><a id="_361"></a>在推荐系统中，有一个刚需就是去重。主要是在两个地方：一个是内容源去重，另一个是不重复给用户推荐。

### <a id="_____312"></a><a id="_362"></a>对内容做重复检测，直观的思路是分词，然后提取关键词，再两两计算词向量之间的距离，距离小于一定阈值后就判定为重复

### <a id="_____314"></a><a id="_363"></a>另一个需求是在内容阅读类推荐场景下，给用户推荐的内容不要重复，推荐过的内容就不再出现在推荐候选集中。

### <a id="_____316"></a><a id="_364"></a>Simhash 为每一个内容生成一个整数指纹，其中的关键是把每个词哈希成一个整数，这一步常常采用 Jenkins 算法。

### <a id="_____318"></a><a id="_365"></a>实际上，解决这类看一个字符串在不在一个集合中的问题，有一个有点老但很好用的做法，就是 Bloomfilter，有时候也被称为布隆过滤器。

### <a id="_____320"></a><a id="_366"></a>布隆过滤器的原理也要用到哈希函数。它包含两部分：一个很长的二进制位向量，和一系列哈希函数

### <a id="_____322"></a><a id="_367"></a>只是哈希函数的结果在两个算法中有不同的处理手段，Simhash 是加权，Bloomfilter 则是用来做寻址。

# <a id="_____324"></a><a id="_164"></a>工程篇：常见架构

## <a id="_____326"></a><a id="_180"></a>24\.典型的信息流架构是什么样的

### <a id="_____328"></a><a id="_228"></a>信息流是推荐系统应用中的当红炸子鸡，它表现形式有很多：社交网络的动态信息流、新闻阅读的图文信息流、短视频信息流等等。

### <a id="_____330"></a><a id="_229"></a>传统的信息流产品知识简单按照时间排序，而被推荐系统接管后的信息流逐渐成为主流，按照兴趣排序，也叫作“兴趣 feed”。

### <a id="_____332"></a><a id="_230"></a>要实现一个信息流，可以划分为两个子问题：1、如何实现一个按照时间顺序排序的信息流系统？2、如何给信息流内容按照兴趣重排序？

### <a id="_____334"></a><a id="_231"></a>整体的框架划分成几个大的模块：日志收集、内容发布、机器学习、信息流服务、监控。

### <a id="_____336"></a><a id="_232"></a>信息流的基本数据有三个：用户（User）、内容（Activity）和关系（Connection）。

### <a id="_____338"></a><a id="_233"></a>用于表达 Activity 的元素有相应的规范，叫作 Atom。根据 Atom 规范的定义，一条 Activity 包含的元素有：Time、Actor、Verb、Object、Target、Title、Summary。

### <a id="_____340"></a><a id="_234"></a>在数据存储上可以选择的工具有下面的几种：Activity 存储可以采用 MySQL、Redis、Cassandra 等；Connection 存储可以采用 MySQL；User 存储可以采用 MySQL。

### <a id="_____342"></a><a id="_235"></a>把动态内容出现在受众的信息流中，直觉上是这样实现的：1、获取用户所有连接的重点\(如好友、关注对象、兴趣标签\)；2、获取这些连接终点\(关注对象\)产生的新内容\(Activity\)；3、按照某个指标排序后输出。

### <a id="_____344"></a><a id="_236"></a>拉模式就是当用户访问时，信息流服务才会去相应的发布源拉取内容到自己的 feed 区来，这是一个阻塞同步的过程。

### <a id="_____346"></a><a id="_237"></a>推模式的实现是系统为每一个用户单独开辟一个信息流存储区域，用于接收推送的内容。

### <a id="_____348"></a><a id="_238"></a>简单的结合方案：对于活跃度高的用户，使用推模式；对于活跃度没有那么高的用户，使用拉模式；对于热门的内容生产者，缓存其最新的N条内容，用于不同场景下的拉取。

### <a id="_____350"></a><a id="_239"></a>对于信息流的产生和存储可以选择的工具有：用户信息流的存储可以采用Redis等KV数据库，使用uid作为key；信息流推送的任务队列可以采用Celery等成熟框架。

### <a id="_____352"></a><a id="_240"></a>避免陷入两个误区：1、没有目标；2、人工量化

### <a id="_____354"></a><a id="_241"></a>目前信息流采用机器学习排序，以提升类似互动率，停留时长等指标，这已经成为共识。

### <a id="_____356"></a><a id="_242"></a>信息流的特征有三类：1、用户特征；2、内容特征；3、其他特征（刷新时间、所处页面等）

### <a id="_____358"></a><a id="_243"></a>信息流是一个数据驱动的系统，既要通过历史数据来寻找算法的最优参数，又要通过新的数据验证排序效果。

### <a id="_____360"></a><a id="_244"></a>数据流管道要使用的相关数据可能有：1、互动行为数据；2、曝光内容；3、互动行为与曝光的映射关系；4、用户画像内容；5、信息流的内容分析数据；

### <a id="_____362"></a><a id="_245"></a>数据的管道可以分成三块：1、生成训练样本，可离线；2、排序模型训练，可离线；3、模型服务化，实时服务。

## <a id="_____364"></a><a id="_181"></a>25\.Netflix个性化推荐架构

### <a id="_____366"></a><a id="_246"></a>一个好的推荐系统架构应该具有这些特质：1、实时响应请求；2、及时、准确、全面记录用户反馈；3、可以优雅降级；4、快速实验多种策略。

### <a id="_____368"></a><a id="_247"></a>整体架构可以分为三个层级：1、离线：不用实时数据，不提供实时服务；2、近线：使用实时数据，不保证实时服务；3、在线：使用实时数据，要保证实时服务

### <a id="_____370"></a><a id="_248"></a>在线层的触发时机是当用户发出请求，也就是用户进入一个推荐场景，推荐位等着展示推荐结果时

### <a id="_____372"></a><a id="_249"></a>哪些计算逻辑适合放在在线层：1、简单的算法逻辑；2、模型的预测阶段；3、商业目标相关的过滤或者调权逻辑；4、场景有关的一些逻辑；5、互动性强的一些算法；

### <a id="_____374"></a><a id="_250"></a>离线层就是躲在推荐系统的大后方，批量、周期性地执行一些计算任务

### <a id="_____376"></a><a id="_251"></a>离线阶段主要面对的数据源就是 Hadoop，实质上是 HDFS。

### <a id="_____378"></a><a id="_252"></a>离线阶段的任务主要是两类：模型训练和推荐结果计算。

### <a id="_____380"></a><a id="_253"></a>近线层结合了离线层和在线层的好处，摒弃了两者的不足。

### <a id="_____382"></a><a id="_254"></a>常用的流计算框架有 Storm，Spark Streaming，FLink 等

### <a id="_____384"></a><a id="_255"></a>简化的架构：1、完全舍弃掉近线层；2、避免使用分布式系统

## <a id="_____386"></a><a id="_182"></a>26\.总览推荐架构和搜索、广告的关系

### <a id="_____388"></a><a id="_256"></a>应对信息过载重担先后交给了两种主要形式，包括以搜索为代表的各种主动寻找信息的形式，以及以推荐为代表的各种被动接受信息的形式。

### <a id="_____390"></a><a id="_257"></a>另外介于两者之间，还有一种商业化解决信息触达问题，就是广告系统

### <a id="_____392"></a><a id="_258"></a>三者都是解决信息过滤问题的

### <a id="_____394"></a><a id="_259"></a>搜索，推荐和广告本质上都在解决信息过载的问题，各自解决的手段、目标不相同，各自诞生在产品生命周期不同阶段，以至于系统实现也不尽相同。

### <a id="_____396"></a><a id="_260"></a>搜索更关注内容消费者，搜索要解决的是精确快速找到想要的结果，最重要的目标是降低延迟和提高相关性。

### <a id="_____398"></a><a id="_261"></a>推荐系统不同于搜索引擎，用户使用搜索时目标明确，而使用推荐系统往往总会漫无目的

### <a id="_____400"></a><a id="_262"></a>搜索和推荐都是为人找信息，而广告是为信息找人。

### <a id="_____402"></a><a id="_263"></a>广告系统关注的是商业利益最大化，精准和相关都不是终极目的，只是其中的一个手段。

### <a id="_____404"></a><a id="_264"></a>架构抽象一下三者的需求共性：本质上都是在匹配，匹配用户的兴趣和需求，但匹配的目标，条件和策略不尽相同。

### <a id="_____406"></a><a id="_265"></a>进一步抽象，分为三步：过滤候选、排序候选、个性化输出。

# <a id="_____408"></a><a id="_165"></a>工程篇：常见模块

## <a id="_____410"></a><a id="_183"></a>27\.巧妇难为无米之炊：数据采集关键要素

### <a id="_____412"></a><a id="_266"></a>数据采集，按照用途分类又有三种：1、报表统计；2、数据分析；3、机器学习

### <a id="_____414"></a><a id="_267"></a>给推荐系统收集日志这件事，依次要讨论的是：日志的数据模型，收集哪些日志，用什么工具收集，收集的日志怎么存储。

### <a id="_____416"></a><a id="_268"></a>所谓数据模型，其实就是把数据归类。

### <a id="_____418"></a><a id="_269"></a>就推荐系统而言，推荐系统要做的事情就是预测那些最终会建立的人和物之间的连接，依赖的是已有的连接，以及人和物的属性

### <a id="_____420"></a><a id="_270"></a>后端收集业务日志好处：1、实时性；2、可及时更新；3、开发简单

## <a id="_____422"></a><a id="_184"></a>28\.让你的推荐系统反应更快：实时推荐

### <a id="_____424"></a><a id="_271"></a>推荐系统从业者所追求的三个要素：捕捉兴趣要更快，指标要更高，系统要更健壮。

### <a id="_____426"></a><a id="_272"></a>一个处在第三层次的实时推荐，需要满足三个条件：1、数据实时进来；2、数据实时计算；3、结果及时更新

### <a id="_____428"></a><a id="_273"></a>Kafka 以生产者消费者的模式吞吐数据

### <a id="_____430"></a><a id="_274"></a>常见的流计算平台有 Twitter 开源的 Storm，“Yahoo！”开源的 S4，还有 Spark 中的 Streaming。

## <a id="_____432"></a><a id="_185"></a>29\.让数据驱动落地，你需要一个实验平台

### <a id="_____434"></a><a id="_275"></a>要做到数据驱动，就要做到两点：第一点是数据，第二点是驱动

### <a id="_____436"></a><a id="_276"></a>要做到驱动，需要一个 AB 实验平台

### <a id="_____438"></a><a id="_277"></a>互联网实验，需要三个要素：1、流量；2、参数；3、结果

### <a id="_____440"></a><a id="_278"></a>所谓重叠实验，就是一个流量从进入产品服务，到最后返回结果呈现给用户，中间设置了好几个检查站，每个检查站都在测试某些东西，这样同时做多组实验就是重叠实验。

### <a id="_____442"></a><a id="_279"></a>重叠实验最大的问题是怎么避免流量偏置，引入三个概念：1、域；2、层；3、桶

### <a id="_____444"></a><a id="_280"></a>流量分配方式：1、Cookie \+ 层ID取模；2、完全随机；3、用户ID\+层ID取模；4、Cookie\+日期取模

## <a id="_____446"></a><a id="_281"></a>30\.推荐系统服务化、存储选型及API设计

### <a id="_____448"></a><a id="_282"></a>提供一个在线服务，需要两个关键元素：数据库和 API。

### <a id="_____450"></a><a id="_283"></a>特征数据有两种，一种是稀疏的，一种是稠密的，稀疏的特征常见就是文本类特征，用户标签之类的，稠密的特征则是各种隐因子模型的产出参数。

### <a id="_____452"></a><a id="_284"></a>特征数据又常常要以两种形态存在：一种是正排，一种是倒排。

### <a id="_____454"></a><a id="_285"></a>正排需要用列式数据库存储，倒排索引需要用 KV 数据库存储。前者最典型的就是 HBase 和 Cassandra，后者就是 Redis 或 Memcached。

### <a id="_____456"></a><a id="_286"></a>ElasticSearch。这原本是一个构建在开源搜索引擎 Lucene 基础上的分布式搜索引擎，也常用于日志存储和分析，但由于它良好的接口设计，扩展性和尚可的性能，也常常被采用来做推荐系统的简单第一版，直接承担了存储和计算的任务。

### <a id="_____458"></a><a id="_287"></a>Cassandra 在数据库的 CAP 理论中可以平滑权衡，而 HBase 则是强一致性，并且 Cassandra 读写性能优于 HBase，因此 Cassandra 更适合推荐系统，

### <a id="_____460"></a><a id="_288"></a>还有一种存储模式，就是键值对内存数据库，这当然首推 Redis。

### <a id="_____462"></a><a id="_289"></a>以下场景中常常见到 Redis 的：1、消息队列；2、优先队列；3、模型参数

### <a id="_____464"></a><a id="_290"></a>Redis 被人诟病的就是不太高可用

### <a id="_____466"></a><a id="_291"></a>API 有两大类，一类数据录入，另一类是推荐服务

### <a id="_____468"></a><a id="_292"></a>1\. 猜你喜欢；2\. 相关推荐；3\. 热门排行榜

# <a id="_____470"></a><a id="_166"></a>工程篇：效果保证

## <a id="_____472"></a><a id="_186"></a>31\.推荐系统的测试方法及常见指标

### <a id="_____474"></a><a id="_293"></a>推荐系统的测试方法有四种： 业务规则扫描、离线模拟测试、在线对比测试、用户访谈。

### <a id="_____476"></a><a id="_297"></a>检测系统到底有多好，其实，也有两类，一类是深度类，一类是广度类。

### <a id="_____478"></a><a id="_294"></a>深度类指标就指在检测系统在这两个工作上是否做得到位，有针对离线模型的指标，也有在线的指标：1、评分准确度；2、排序；3、分类准确度；4、覆盖率；5、失效率；6、新颖性；7、更新率

### <a id="_____480"></a><a id="_295"></a>通常检测推荐系统的商业指标有：点击率，转化率。

### <a id="_____482"></a><a id="_296"></a>衡量推荐系统是否健康的指标常用的有三个：1、个性化；2、基尼系数；3、多样性

### <a id="_____484"></a><a id="_298"></a>推荐系统作为一种 AI 系统，其测试方法不完全相同于传统软件功能测试。

## <a id="_____486"></a><a id="_187"></a>32\.道高一尺魔高一丈：推荐系统的攻防

### <a id="_____488"></a><a id="_299"></a>被研究得最为彻底的就是针对协同过滤的攻防：一方面是协同过滤本身就应用广泛，另一方面是针对协同过滤的攻击容易生效。

### <a id="_____490"></a><a id="_300"></a>所以攻击协同过滤，核心问题在于如何操纵选民。选民有两种，一种是用户，一种是物品，前者是基于用户的协同过滤所需要的，后者是基于物品的协同过滤所需要的。

### <a id="_____492"></a><a id="_301"></a>通常的手段就是，批量制造假用户资料，并装作是与被欺骗用户兴趣相投的人。托攻击或者 Shilling Attacks，托也就是水军。

### <a id="_____494"></a><a id="_302"></a>攻击手段包含这些元素：1、目标物品，就是攻击方要扶持或者打压的那个物品；2、助攻物品，就是用来构造假的相似用户所需要的物品；3、陪跑物品，就是用来掩饰造假的物品

### <a id="_____496"></a><a id="_303"></a>分段攻击就是想办法把目标物品引入到某个群体中，做法就是攻击者先圈定好用户群体，再列出这个群体肯定喜欢的物品集合，然后同时用假用户给目标物品和这批物品集合评分，做法类似热门攻击。

### <a id="_____498"></a><a id="_304"></a>防护手段按照层级，可以分为下面几种：1、平台级；2、数据级；3、算法级

### <a id="_____500"></a><a id="_305"></a>平台级：一面是提高批量注册用户的成本，另一方面是产品教育用户积极参与，并提供真实的反馈

### <a id="_____502"></a><a id="_306"></a>数据级：数据级别防护重点是从数据中识别出哪些数据是假的，哪些用户是被操纵的选民。通常是采用机器学习思路，标注一批假用户或假反馈数据，训练分类器，在线上识别出反馈。

### <a id="_____504"></a><a id="_307"></a>算法级：算法级别就是在推荐算法设计时，要根据情况做一些改进和选择

### <a id="_____506"></a><a id="_308"></a>改进方向包括下面几种：1、引入用户质量，限制对于低质量的用户参与计算，或者限制新用户参与计算；2、限制每个用户的投票权重，即在计算用户相似度时引入较重的平滑因子，使得用户之间的相似度不容易出现过高的值

## <a id="_____508"></a><a id="_188"></a>33\.和推荐系统有关的开源工具及框架介绍

### <a id="_____510"></a><a id="_309"></a>文本分析相关的工作就是将非结构化的文本转换为结构化。主要的工作就是三类：1、主题模型；2、词嵌入；3、文本分类；

### <a id="_____512"></a><a id="_310"></a>基于用户、基于物品的协同过滤，矩阵分解，都依赖对用户物品关系矩阵的利用。常常要涉及的工作有下面几种：1、KNN相似度计算；2、SVD矩阵分解；3、SVD\+\+矩阵分解；4、ALS矩阵分解；5、BPR矩阵分解；6、低维稠密向量近邻搜索

### <a id="_____514"></a><a id="_311"></a>模型融合这部分，有线性模型、梯度提升树模型。

### <a id="_____516"></a><a id="_312"></a>所谓完整的推荐系统是指：包含推荐算法实现、存储、接口。

### <a id="_____518"></a><a id="_313"></a>倾向于选择各个模块的开源项目，再将其组合集成为自己的推荐系统，这样的好处有下面几种：1、单个模块开源项目容易入手，学习成本低，性能好；2、自己组合后更容易诊断问题，不需要的不用开发；3、单个模块的性能和效果更有保证。

# <a id="_____520"></a><a id="_167"></a>产品篇

## <a id="_____522"></a><a id="_189"></a>34\.推荐系统在互联网产品商业链条中的地位

### <a id="_____524"></a><a id="_314"></a>推荐系统处理的是信息，它的主要作用是在信息生产方和信息消费方搭建起桥梁。

### <a id="_____526"></a><a id="_315"></a>信息经济其实就是注意力经济，而推荐系统就是留住注意力的重要手段。

### <a id="_____528"></a><a id="_316"></a>注意力有个特点：总量有限。随着信息越来越丰富，注意力越来越稀缺。

### <a id="_____530"></a><a id="_317"></a>个人把注意力定义为：内容被消耗的加速度与平台内容复杂度的乘积。

### <a id="_____532"></a><a id="_318"></a>制定一些提升平台剩余注意力的策略：1、内容创作适当少倾注注意力；2、提升内容难度；3、提高单用户消耗加速度；4、提高活跃用户数

### <a id="_____534"></a><a id="_319"></a>打造一个推荐系统的成本分布在这几个地方：1、团队成本；2、硬件成本；3、机会成本；

## <a id="_____536"></a><a id="_190"></a>35\.说说信息流的前世今生

### <a id="_____538"></a><a id="_320"></a>最厉害的注意力存储器就是信息流，尤其是个性化信息流，也叫做兴趣 Feed，

### <a id="_____540"></a><a id="_321"></a>NewsFeed 的成功，验证了几个常识：1、数据驱动比舆论驱动靠谱，别听人们嘴上是怎么说的，只看人们是如何行动的；2、窥探隐私，向群体靠拢，害怕孤单是普遍人性，把新鲜事公开这件事验证了这一点；3、注意力非常有限，用推荐系统的方法更好地储存注意力，基于兴趣的信息流验证了这一点。

### <a id="_____542"></a><a id="_322"></a>内容源是信息流的一种重要基础设施，要想尽办法建设好。内容源应该考虑下面几种：1、质量；2、多样性；3、质量

### <a id="_____544"></a><a id="_323"></a>NewsFeed 还有另一个配套设施，那就是吸金的广告系统

## <a id="_____546"></a><a id="_191"></a>36\.组件推荐团队及工程师的学习路径

### <a id="_____548"></a><a id="_324"></a>定义团队的角色：算法工程师，软件开发工程师，其他非技术角色

### <a id="_____550"></a><a id="_325"></a>个人成长具备三个核心素质：1、有较强的工程能力；2、有较强的理论基础；3、有很好的可视化思维

### <a id="_____552"></a><a id="_326"></a>非典型工程师的加分项：1、学习能力；2、沟通能力；3、表达能力

# <a id="_____554"></a><a id="_168"></a>结束语与参考阅读

